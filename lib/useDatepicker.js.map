{"version":3,"file":"useDatepicker.js","names":["generateCurrent","curDate","calendar","yearString","year","date","month","monthName","local","monthNames","firstMonth","monthNameShort","monthNamesShort","yearLocal","localiseDigits","generateDays","onSelect","setCurDate","minDate","maxDate","selectDaysInOtherMonths","showDaysInOtherMonths","value","today","daysInWeek","monthFirst","set","minDay","monthCalc","sub","dayOfWeek","add","firstDay","monthStart","day","monthLast","weekCount","Math","ceil","toJD","monthEnd","days","forDay","week","thisDay","isInCurrentMonth","isDisabled","compareTo","isSelected","isToday","isWeekend","weekDay","label","String","selectDay","push","generateYears","options","years","selectYear","yearLimits","yearRange","split","map","parseInt","length","some","isNaN","max","min","y","name","generateLocal","dayNames","dayNamesMin","dayNamesShort","isRTL","m","daysInMonth","_","i","index","nameMin","nameShort","months","disabled","getStartOfWeek","dow","getEndOfWeek","d1","d2","generateUpdates","setTarget","target","nextDay","nextMonth","nextWeek","nextYear","prevDay","prevMonth","prevWeek","prevYear","setMonth","setYear","weekEnd","weekStart","generateDatepicker","current","updates","noOptions","useDatepicker","calendarName","language","Calendars","instance","useState","datepicker","setDatepicker","useEffect","newDate"],"sources":["../src/useDatepicker.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport Calendars, { CDate } from '@kbwood/world-calendars';\r\n\r\ntype Notify = () => void\r\ntype NotifyDate = (date: CDate) => void\r\ntype NotifyPeriod = (period: string | number) => void\r\ntype Current = {\r\n  date: CDate,\r\n  month: number,\r\n  monthName: string,\r\n  monthNameShort: string,\r\n  year: number,\r\n  yearLocal: string,\r\n}\r\ntype Day = {\r\n  date: CDate,\r\n  isDisabled: boolean,\r\n  isInCurrentMonth: boolean,\r\n  isSelected: boolean,\r\n  isToday: boolean,\r\n  isWeekend: boolean,\r\n  label: string,\r\n  selectDay: Notify,\r\n}\r\ntype LocalDay = {\r\n  name: string,\r\n  nameMin: string,\r\n  nameShort: string,\r\n}\r\ntype LocalMonth = {\r\n  disabled: boolean,\r\n  name: string,\r\n  nameShort: string,\r\n  value: number,\r\n}\r\ntype LocalYear = {\r\n  name: string,\r\n  value: number,\r\n}\r\ntype Local = {\r\n  days: LocalDay[],\r\n  isRTL: boolean,\r\n  months: LocalMonth[],\r\n  years: LocalYear[],\r\n}\r\ntype Updates = {\r\n  nextDay: Notify,\r\n  nextMonth: Notify,\r\n  nextWeek: Notify,\r\n  nextYear: Notify,\r\n  prevDay: Notify,\r\n  prevMonth: Notify,\r\n  prevWeek: Notify,\r\n  prevYear: Notify,\r\n  setMonth: NotifyPeriod,\r\n  setYear: NotifyPeriod,\r\n  today: Notify,\r\n  weekEnd: Notify,\r\n  weekStart: Notify,\r\n}\r\ntype Datepicker = {\r\n  current: Current,\r\n  days: Day[][],\r\n  local: Local,\r\n  updates: Updates,\r\n}\r\n\r\ntype DisplayOptions = {\r\n  selectDaysInOtherMonths?: boolean,\r\n  selectMonth?: boolean,\r\n  selectYear?: boolean,\r\n  showDaysInOtherMonths?: boolean,\r\n  yearRange?: string,\r\n}\r\ntype Props = {\r\n  calendarName: string,\r\n  date?: CDate,\r\n  language?: string,\r\n  maxDate?: CDate,\r\n  minDate?: CDate,\r\n  onSelect: NotifyDate,\r\n  options?: DisplayOptions,\r\n}\r\ntype OptCDate = CDate | undefined\r\n\r\nconst generateCurrent = (curDate: CDate): Current => {\r\n  const calendar = curDate.calendar();\r\n  const yearString = `${curDate.year()}`;\r\n  return {\r\n    date: curDate,\r\n    month: curDate.month(),\r\n    monthName: calendar.local.monthNames[curDate.month() - calendar.firstMonth],\r\n    monthNameShort: calendar.local.monthNamesShort[curDate.month() - calendar.firstMonth],\r\n    year: curDate.year(),\r\n    yearLocal: calendar.local.localiseDigits ? calendar.local.localiseDigits(yearString) : yearString\r\n  };\r\n};\r\n\r\nconst generateDays = (\r\n  onSelect: NotifyDate,\r\n  curDate: CDate,\r\n  setCurDate: NotifyDate,\r\n  minDate: OptCDate,\r\n  maxDate: OptCDate,\r\n  { selectDaysInOtherMonths, showDaysInOtherMonths }: DisplayOptions\r\n): Day[][] => {\r\n  const calendar = curDate.calendar();\r\n  const localiseDigits = calendar.local.localiseDigits || (value => value);\r\n  const today = calendar.date();\r\n  const daysInWeek = calendar.daysInWeek();\r\n  const monthFirst = curDate.set(calendar.minDay, 'd');\r\n  const monthCalc = monthFirst\r\n    .sub(monthFirst.dayOfWeek(), 'd')\r\n    .add(calendar.local.firstDay, 'd');\r\n  const monthStart =\r\n    monthCalc.month() === curDate.month() && monthCalc.day() > calendar.minDay ? monthCalc.sub(1, 'w') : monthCalc;\r\n  const monthLast = monthFirst.add(1, 'm').sub(1, 'd');\r\n  const weekCount = Math.ceil(\r\n    (monthLast.toJD() - monthStart.toJD() + 1) / daysInWeek\r\n  );\r\n  const monthEnd = monthStart.add(weekCount, 'w').sub(1, 'd');\r\n\r\n  const days: Day[][] = [];\r\n  let forDay = monthStart;\r\n  let week = 0;\r\n  while (forDay.compareTo(monthEnd) <= 0) {\r\n    const thisDay = forDay.date();\r\n    const isInCurrentMonth = thisDay.month() === curDate.month();\r\n    const isDisabled = (!!minDate && thisDay.compareTo(minDate) === -1) ||\r\n      (!!maxDate && thisDay.compareTo(maxDate) === 1) ||\r\n      !(selectDaysInOtherMonths || isInCurrentMonth);\r\n    const day = {\r\n      date: thisDay,\r\n      isDisabled,\r\n      isInCurrentMonth,\r\n      isSelected: thisDay.compareTo(curDate) === 0,\r\n      isToday: thisDay.compareTo(today) === 0,\r\n      isWeekend: !thisDay.weekDay(),\r\n      label: (showDaysInOtherMonths || isInCurrentMonth) ? `${localiseDigits(String(thisDay.day()))}` : '',\r\n      selectDay: () => { setCurDate(thisDay); onSelect(thisDay); }\r\n    };\r\n    if (!days[week]) {\r\n      days[week] = [];\r\n    }\r\n    days[week].push(day);\r\n    forDay = forDay.add(1, 'd');\r\n    if (forDay.dayOfWeek() === calendar.local.firstDay) {\r\n      week += 1;\r\n    }\r\n  }\r\n  return days;\r\n};\r\n\r\nconst generateYears = (curDate: CDate, minDate: OptCDate, maxDate: OptCDate, options: DisplayOptions): LocalYear[] => {\r\n  const years: LocalYear[] = [];\r\n  if (!options.selectYear) {\r\n    return years;\r\n  }\r\n  const yearLimits = (options.yearRange || '').split(':').map(value => parseInt(value, 10));\r\n  if (yearLimits.length !== 2 || yearLimits.some(value => isNaN(value))) {\r\n    return years;\r\n  }\r\n  yearLimits[0] = minDate ? Math.max(minDate.year(), yearLimits[0]) : yearLimits[0];\r\n  yearLimits[1] = maxDate ? Math.min(maxDate.year(), yearLimits[1]) : yearLimits[1];\r\n  const calendar = curDate.calendar();\r\n  const localiseDigits = calendar.local.localiseDigits || (value => value);\r\n  for (let y = yearLimits[0]; y <= yearLimits[1]; y += 1) {\r\n    years.push({ name: localiseDigits(`${y}`), value: y });\r\n  }\r\n  return years;\r\n};\r\n\r\nconst generateLocal = (curDate: CDate, minDate: OptCDate, maxDate: OptCDate, options: DisplayOptions): Local => {\r\n  const calendar = curDate.calendar();\r\n  const daysInWeek = calendar.daysInWeek();\r\n  const year = curDate.year();\r\n  const { dayNames, dayNamesMin, dayNamesShort, firstDay, isRTL, monthNames, monthNamesShort } = calendar.local;\r\n  const isDisabled = (m: number) =>\r\n    (!!maxDate && calendar.date(year, m, calendar.minDay).compareTo(maxDate) > 0) ||\r\n    (!!minDate && calendar.date(year, m, calendar.daysInMonth(year, m)).compareTo(minDate) < 0);\r\n  return {\r\n    days: dayNames.map((_, i) => {\r\n      const index = (i + firstDay) % daysInWeek;\r\n      return {\r\n        name: dayNames[index],\r\n        nameMin: dayNamesMin[index],\r\n        nameShort: dayNamesShort[index]\r\n      };\r\n    }),\r\n    isRTL,\r\n    months: monthNames.map((name, i) => ({\r\n      disabled: isDisabled(i + calendar.firstMonth),\r\n      name,\r\n      nameShort: monthNamesShort[i],\r\n      value: i + calendar.firstMonth\r\n    })),\r\n    years: generateYears(curDate, minDate, maxDate, options)\r\n  };\r\n};\r\n\r\nconst getStartOfWeek = (date: CDate): CDate => {\r\n  const firstDay = date.calendar().local.firstDay;\r\n  const dow = date.dayOfWeek();\r\n  return date.sub(dow < firstDay ? date.calendar().daysInWeek() : dow, 'd').add(firstDay, 'd');\r\n};\r\n\r\nconst getEndOfWeek = (date: CDate): CDate =>\r\n  getStartOfWeek(date).add(date.calendar().daysInWeek() - 1, 'd');\r\n\r\nconst max = (d1: CDate, d2: CDate = d1): CDate => d1.compareTo(d2) === 1 ? d1 : d2;\r\n\r\nconst min = (d1: CDate, d2: CDate = d1): CDate => d1.compareTo(d2) === -1 ? d1 : d2;\r\n\r\nconst generateUpdates = (curDate: CDate, setCurDate: NotifyDate, minDate: OptCDate, maxDate: OptCDate): Updates => {\r\n  const setTarget = (target: CDate) => () => { setCurDate(max(min(target, maxDate), minDate)); };\r\n  return {\r\n    nextDay: setTarget(curDate.add(1, 'd')),\r\n    nextMonth: setTarget(curDate.add(1, 'm')),\r\n    nextWeek: setTarget(curDate.add(1, 'w')),\r\n    nextYear: setTarget(curDate.add(1, 'y')),\r\n    prevDay: setTarget(curDate.sub(1, 'd')),\r\n    prevMonth: setTarget(curDate.sub(1, 'm')),\r\n    prevWeek: setTarget(curDate.sub(1, 'w')),\r\n    prevYear: setTarget(curDate.sub(1, 'y')),\r\n    setMonth: (month: string | number) => { setTarget(curDate.set(parseInt(`${month}`, 10), 'm'))(); },\r\n    setYear: (year: string | number) => { setTarget(curDate.set(parseInt(`${year}`, 10), 'y'))(); },\r\n    today: setTarget(curDate.calendar().date()),\r\n    weekEnd: setTarget(getEndOfWeek(curDate)),\r\n    weekStart: setTarget(getStartOfWeek(curDate))\r\n  };\r\n};\r\n\r\nconst generateDatepicker = (\r\n  onSelect: NotifyDate,\r\n  curDate: CDate,\r\n  setCurDate: NotifyDate,\r\n  minDate: OptCDate,\r\n  maxDate: OptCDate,\r\n  options: DisplayOptions\r\n): Datepicker => ({\r\n  current: generateCurrent(curDate),\r\n  days: generateDays(onSelect, curDate, setCurDate, minDate, maxDate, options),\r\n  local: generateLocal(curDate, minDate, maxDate, options),\r\n  updates: generateUpdates(curDate, setCurDate, minDate, maxDate)\r\n});\r\n\r\nconst noOptions: DisplayOptions = {};\r\n\r\nconst useDatepicker = ({\r\n  calendarName,\r\n  date,\r\n  language = '',\r\n  maxDate,\r\n  minDate,\r\n  onSelect,\r\n  options = noOptions\r\n}: Props) => {\r\n  const calendar = Calendars.instance(calendarName, language);\r\n  const [curDate, setCurDate] = useState<CDate>(date || calendar.date());\r\n  const [datepicker, setDatepicker] = useState<Datepicker>(\r\n    generateDatepicker(onSelect, curDate, setCurDate, minDate, maxDate, options)\r\n  );\r\n\r\n  useEffect(() => {\r\n    const newDate = date || calendar.date();\r\n    if (newDate.calendar() !== curDate.calendar() || newDate.compareTo(curDate) !== 0) {\r\n      setCurDate(newDate);\r\n    }\r\n  }, [calendar, date]);\r\n\r\n  useEffect(() => {\r\n    setDatepicker(generateDatepicker(onSelect, curDate, setCurDate, minDate, maxDate, options));\r\n  }, [curDate, maxDate, minDate, onSelect, options, setCurDate, setDatepicker]);\r\n\r\n  return datepicker;\r\n};\r\n\r\nexport type {\r\n  Current,\r\n  Datepicker,\r\n  Day,\r\n  DisplayOptions,\r\n  Local,\r\n  LocalDay,\r\n  LocalMonth,\r\n  LocalYear,\r\n  Notify,\r\n  NotifyDate,\r\n  NotifyPeriod,\r\n  Updates\r\n};\r\nexport default useDatepicker;\r\n"],"mappings":"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"}