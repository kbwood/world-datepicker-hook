{"version":3,"file":"useDatepicker.js","names":["generateDays","onSelect","curDate","setCurDate","calendar","localiseDigits","local","value","today","date","daysInWeek","monthFirst","set","minDay","monthCalc","sub","dayOfWeek","add","firstDay","monthStart","month","day","monthLast","weekCount","Math","ceil","toJD","monthEnd","days","forDay","thisDay","isDisabled","isInCurrentMonth","isSelected","compareTo","isToday","isWeekend","weekDay","label","String","onClick","push","generateUpdates","nextDay","nextMonth","nextWeek","nextYear","prevDay","prevMonth","prevWeek","prevYear","weekEnd","weekStart","generateDatepicker","calendarDays","isRTL","name","monthNames","firstMonth","num","updates","weekDays","dayNamesMin","year","useDatepicker","calendarName","language","Calendars","instance","useState","datepicker","setDatepicker","useEffect","newDate"],"sources":["../src/useDatepicker.ts"],"sourcesContent":["import { MouseEventHandler, useEffect, useState } from 'react';\r\nimport Calendars, { CDate } from '@kbwood/world-calendars';\r\n\r\ntype NotifyDate = (date: CDate) => void\r\ntype CalendarDay = {\r\n  date: CDate,\r\n  isDisabled: boolean,\r\n  isInCurrentMonth: boolean,\r\n  isSelected: boolean,\r\n  isToday: boolean,\r\n  isWeekend: boolean,\r\n  label: string,\r\n  onClick: MouseEventHandler,\r\n}\r\ntype DatepickerUpdates = {\r\n  nextDay: MouseEventHandler,\r\n  nextMonth: MouseEventHandler,\r\n  nextWeek: MouseEventHandler,\r\n  nextYear: MouseEventHandler,\r\n  prevDay: MouseEventHandler,\r\n  prevMonth: MouseEventHandler,\r\n  prevWeek: MouseEventHandler,\r\n  prevYear: MouseEventHandler,\r\n  weekEnd: MouseEventHandler,\r\n  weekStart: MouseEventHandler,\r\n}\r\ntype MonthData = {\r\n  name: string,\r\n  num: number,\r\n}\r\ntype Datepicker = {\r\n  calendarDays: CalendarDay[],\r\n  isRTL: boolean,\r\n  month: MonthData,\r\n  updates: DatepickerUpdates,\r\n  weekDays: string[],\r\n  year: number,\r\n}\r\n\r\nconst generateDays = (onSelect: NotifyDate, curDate: CDate, setCurDate: NotifyDate): CalendarDay[] => {\r\n  const calendar = curDate.calendar();\r\n  const localiseDigits = calendar.local.localiseDigits || (value => value);\r\n  const today = calendar.date();\r\n  const daysInWeek = calendar.daysInWeek();\r\n  const monthFirst = curDate.set(calendar.minDay, 'd');\r\n  const monthCalc = monthFirst\r\n    .sub(monthFirst.dayOfWeek(), 'd')\r\n    .add(calendar.local.firstDay, 'd');\r\n  const monthStart =\r\n    monthCalc.month() === curDate.month() && monthCalc.day() > calendar.minDay ? monthCalc.sub(1, 'w') : monthCalc;\r\n  const monthLast = monthFirst.add(1, 'm').sub(1, 'd');\r\n  const weekCount = Math.ceil(\r\n    (monthLast.toJD() - monthStart.toJD() + 1) / daysInWeek\r\n  );\r\n  const monthEnd = monthStart.add(weekCount, 'w').sub(1, 'd');\r\n\r\n  const days: CalendarDay[] = [];\r\n  let forDay = monthStart;\r\n  while (forDay.compareTo(monthEnd) <= 0) {\r\n    const thisDay = forDay.date();\r\n    const day = {\r\n      date: thisDay,\r\n      isDisabled: false,\r\n      isInCurrentMonth: thisDay.month() === curDate.month(),\r\n      isSelected: thisDay.compareTo(curDate) === 0,\r\n      isToday: thisDay.compareTo(today) === 0,\r\n      isWeekend: !thisDay.weekDay(),\r\n      label: `${localiseDigits(String(thisDay.day()))}`,\r\n      onClick: () => { setCurDate(thisDay); onSelect(thisDay); }\r\n    };\r\n    days.push(day);\r\n    forDay = forDay.add(1, 'd');\r\n  }\r\n  return days;\r\n};\r\n\r\nconst generateUpdates = (curDate: CDate, setCurDate: NotifyDate): DatepickerUpdates => {\r\n  return {\r\n    nextDay: () => { setCurDate(curDate.add(1, 'd')); },\r\n    nextMonth: () => { setCurDate(curDate.add(1, 'm')); },\r\n    nextWeek: () => { setCurDate(curDate.add(1, 'w')); },\r\n    nextYear: () => { setCurDate(curDate.add(1, 'y')); },\r\n    prevDay: () => { setCurDate(curDate.sub(1, 'd')); },\r\n    prevMonth: () => { setCurDate(curDate.sub(1, 'm')); },\r\n    prevWeek: () => { setCurDate(curDate.sub(1, 'w')); },\r\n    prevYear: () => { setCurDate(curDate.sub(1, 'y')); },\r\n    weekEnd: () => { setCurDate(curDate.add(1, 'd')); },\r\n    weekStart: () => { setCurDate(curDate.sub(1, 'd')); }\r\n  };\r\n};\r\n\r\nconst generateDatepicker = (onSelect: NotifyDate, curDate: CDate, setCurDate: NotifyDate): Datepicker => {\r\n  const calendar = curDate.calendar();\r\n  return {\r\n    calendarDays: generateDays(onSelect, curDate, setCurDate),\r\n    isRTL: calendar.local.isRTL,\r\n    month: {\r\n      name: calendar.local.monthNames[curDate.month() - calendar.firstMonth],\r\n      num: curDate.month()\r\n    },\r\n    updates: generateUpdates(curDate, setCurDate),\r\n    weekDays: calendar.local.dayNamesMin,\r\n    year: curDate.year()\r\n  };\r\n};\r\n\r\nconst useDatepicker = (onSelect: NotifyDate, calendarName: string, language: string = '', date?: CDate) => {\r\n  const calendar = Calendars.instance(calendarName, language);\r\n  const [curDate, setCurDate] = useState<CDate>(date || calendar.date());\r\n  const [datepicker, setDatepicker] = useState<Datepicker>(generateDatepicker(onSelect, curDate, setCurDate));\r\n\r\n  useEffect(() => {\r\n    const newDate = date || calendar.date();\r\n    if (newDate.calendar() !== curDate.calendar() || newDate.compareTo(curDate) !== 0) {\r\n      setCurDate(newDate);\r\n    }\r\n  }, [calendar, date]);\r\n\r\n  useEffect(() => {\r\n    setDatepicker(generateDatepicker(onSelect, curDate, setCurDate));\r\n  }, [curDate, onSelect, setCurDate, setDatepicker]);\r\n\r\n  return datepicker;\r\n};\r\n\r\nexport type { CalendarDay, Datepicker, DatepickerUpdates, MonthData, NotifyDate };\r\nexport default useDatepicker;\r\n"],"mappings":"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"}